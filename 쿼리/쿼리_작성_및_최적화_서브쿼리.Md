# ***쿼리 작성 및 최적화***  

## `서브쿼리`  

### SELECT 절에 사용된 서브쿼리  
SELECT 절에 사용된 서브쿼리는 내부적으로 임시 테이블을 만들거나 쿼리를 비효율적으로 실행하게 만들지는 않기 때문에 서브쿼리가 적절히 힌덱스를 사용할 수 있다면 크게 주의할 사항은 없다.  
  
스칼라 서브쿼리 - 레코드의 컬림이 각각 하나인 결과를 만들어내는 서브쿼리.  
로우 또는 레코드 서브쿼리 - 레코드 건수가 많거나 컬럼 수가 많은 결과를 만들어 내는 쿼리.    

### WHERE 절에 사용된 서브쿼리  

`동등 또는 크다 작다 비교`  

```
SELECT * FROM dept_emp de
WHERE de.emp_no=(
    SELECT e.emp_no
    FROM employees e
    WHEREe.first_name='Georgi' AND e.last_name='Facello' LIMIT 1)
    );
```  

(MYSQL 5.5 이후) 위의 쿼리의 경우 서브쿼리를 먼저 실행한 후, 상숫값으로 서브쿼리를 대체해서 나머지 쿼리 부분을 처리한다.  

<span style="color:cornflowerblue">  
하지만, MYSQL 8.0 버전이라고 하더라도 튜플 형태의 비교의 경우 서브쿼리가 먼저 처리되어 상수화되긴 하지만  
외부 쿼리는 인덱스를 사용하지 못하고 풀 스캔을 실행하니 주의해야한다. 
</span>


### IN 비교  
실제 조인은 아니지만 IN절에 subquery를 사용하는 방법을 세미 조인이라고 한다.  
MYSQL 8.0 세미 조인의 최적화가 많이 진행되어 우회할 방법을 찾을 필요가 없다.  
세미 조인에는 5개의 최적화 전략을 선택적으로 사용한다.  
- 테이블 풀-아웃  
- 퍼스트 매치
- 루스 스캔
- 구체화
- 중복 제거

-> 5가지 전략에 대해 추가 학습  

### NOT IN 비교  
IN 비교와 비슷하지만 이를 세미 조인이라고 칭한다.  
- NOT EXISTS
- 구체화  
두 가지 방법 모두 성능 향상에 도움이 되지 않음으로 쿼리가 최대한 다른 조건을 활용해서 데이터 검색 범위를 좁힐 수 있게 하는 것이 좋다.  


